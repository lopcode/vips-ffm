<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (23) -->
<title>Overview (core API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="module index">
<meta name="generator" content="javadoc/ModuleIndexWriter">
<link rel="stylesheet" type="text/css" href="resource-files/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="resource-files/stylesheet.css" title="Style">
<script type="text/javascript" src="script-files/script.js"></script>
<script type="text/javascript" src="script-files/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="script-files/jquery-ui.min.js"></script>
</head>
<body class="module-index-page">
<script type="text/javascript">const pathtoroot = "./";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="nav-content">
<div class="nav-menu-button"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button></div>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li class="nav-bar-cell1-rev">Overview</li>
<li><a href="overview-tree.html">Tree</a></li>
<li><a href="deprecated-list.html">Deprecated</a></li>
<li><a href="index-all.html">Index</a></li>
<li><a href="search.html">Search</a></li>
<li><a href="help-doc.html#overview">Help</a></li>
</ul>
</div>
</div>
<div class="sub-nav">
<div class="nav-content">
<ol class="sub-nav-list"></ol>
<div class="nav-list-search">
<input type="text" id="search-input" disabled placeholder="Search" aria-label="Search in documentation" autocomplete="off">
<input type="reset" id="reset-search" disabled value="Reset">
</div>
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="main-grid">
<main role="main">
<div class="header">
<h1 class="title">core API</h1>
</div>
<div class="block"><h1 id="vips-ffm-heading">vips-ffm</h1>
<p><a href="https://github.com/libvips/libvips">libvips</a> bindings for JVM projects, using the &quot;Foreign Function &amp; Memory API&quot;
(<a href="https://openjdk.org/jeps/454">JEP 454</a>), and the &quot;Class-File API&quot; (<a href="https://openjdk.org/jeps/457">JEP 457</a>) released in JDK 22. The combination
of libvips, FFM, and auto-generated helpers means these bindings are complete (supporting all libvips operations), safe,
and <a href="https://github.com/lopcode/vips-ffm/issues/59#issuecomment-2367634956">faster</a> than AWT or JNI-based alternatives.</p>
<p>Supports a vast range of image formats, including HEIC, JXL, WebP, PNG, JPEG, and more. Pronounced &quot;vips (like zips)
eff-eff-emm&quot;. The project is relatively new, but aims to be production ready. Tested on macOS 14, Windows 11, and Linux
(Ubuntu 24.04).</p>
<p>Used the library, or just like what you've read so far? Please give <a href="https://github.com/lopcode/vips-ffm">the repo</a> a star üåüÔ∏è!</p>
<h2 id="usage-heading">Usage</h2>
<p><code>vips-ffm</code> is available on Maven Central. To get set up with Gradle:</p>
<pre><code class="language-kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;app.photofox.vips-ffm:vips-ffm-core:0.5.14&quot;)
}
</code></pre>
<p>When running your project you must add <code>--enable-native-access=ALL-UNNAMED</code> to your JVM runtime arguments. If you
don't, you'll get a warning about &quot;Restricted methods&quot;. In the future, the JVM will throw an error if you don't
explicitly include this flag.</p>
<p>As the project uses the Java FFM API, it must target JDK 22+. Bindings are currently generated from libvips <code>8.15.3</code>,
however they use the underlying libvips operation API. Most operations <strong>do not</strong> use the C API directly (as described
in the <a href="https://www.libvips.org/API/current/binding.html">bindings docs</a>) - they should be safe to use with different
libvips versions, assuming there haven't been major changes.</p>
<blockquote>
<p>[!NOTE]
This library <strong>does not</strong> include <code>libvips</code> in the download, you must add it to the system/container you're building
for, then make sure it's available in <code>DYLD_LIBRARY_PATH</code> (on macOS), <code>LD_LIBRARY_PATH</code> (on Linux), or <code>PATH</code> (on
Windows).</p>
</blockquote>
<p>All libvips operations are exposed via helper classes, like <code>VImage</code>. You must provide an <a href="https://docs.oracle.com/en/java/javase/22/core/memory-segments-and-arenas.html">Arena</a> to operations like
<code>VImage.newFromFile</code>, which constrains the lifetime of objects generated during usage. You can get an appropriate arena
by using <code>Vips.run</code> as shown in the <a href="#thumbnail-sample">sample</a> below. <code>VImage</code> and associated enums have extensive
Javadocs included, which are automatically generated from the same source that the libvips website uses, for ease of use.
These helper objects expose their raw pointers as a last resort via functions like <code>VTarget.getUnsafeStructAddress</code> - if
you need to use these raw pointers and can't find an alternative, please file a GitHub Issue.</p>
<p>Helper enums are generated for the version of libvips shown above. If you need to use an enum from another version,
which isn't present in <code>vips-ffm</code>, you can use <code>VipsOption.Enum(rawValue)</code> or <code>VEnum.Raw(rawValue)</code>.</p>
<blockquote>
<p>[!CAUTION]
Bindings generated by <code>jextract</code> are available in <code>VipsRaw</code>, and wrapped with validation in <code>VipsHelper</code>. These
functions are difficult to use without accidentally causing memory leaks, or even segfaults! If what you want to do is
available in <code>VImage</code> and other <code>V</code>-prefixed classes, use those instead. If you notice something missing, please open
a GitHub Issue.</p>
</blockquote>
<h3 id="thumbnail-sample-heading">Thumbnail sample</h3>
<p>To get a feeling for the bindings, here's an indicative sample written in Kotlin (using the Java bindings) that:</p>
<ul>
<li>Loads an original JPEG image from disk</li>
<li>Writes a copy of it to disk</li>
<li>Creates a 400px thumbnail from the original, and writes that to disk</li>
</ul>
<pre><code class="language-kotlin">import app.photofox.vipsffm.Vips
import app.photofox.vipsffm.VImage
import app.photofox.vipsffm.VipsOption
import app.photofox.vipsffm.enums.VipsAccess

// ...

// Call once to initialise libvips when your program starts, from any thread
Vips.init()

// Use `Vips.run` to wrap your usage of the API, and get an arena with an appropriate lifetime to use
// Usage of the API, arena, and resulting V-Objects must be done from the thread that called `Vips.run`
Vips.run { arena -&gt;
    val sourceImage = VImage.newFromFile(
      arena,
      &quot;sample/src/main/resources/sample_images/rabbit.jpg&quot;,
      VipsOption.Enum(&quot;access&quot;, VipsAccess.ACCESS_SEQUENTIAL)
    )
    val sourceWidth = sourceImage.width
    val sourceHeight = sourceImage.height
    logger.info(&quot;source image size: $sourceWidth x $sourceHeight&quot;)

    val outputPath = workingDirectory.resolve(&quot;rabbit_copy.jpg&quot;)
    sourceImage.writeToFile(outputPath.absolutePathString())

    val thumbnail = sourceImage.thumbnail(
      &quot;sample/src/main/resources/sample_images/rabbit.jpg&quot;,
      400
    )
    val thumbnailWidth = thumbnail.width
    val thumbnailHeight = thumbnail.height
    logger.info(&quot;thumbnail image size: $thumbnailWidth x $thumbnailHeight&quot;)
}

// Optionally call at the end of your program, for memory leak detection, from any thread
Vips.shutdown()
</code></pre>
<h2 id="samples-heading">Samples</h2>
<p>Samples are included that show various usages of these bindings. They include validations, and run on GitHub Actions as
&quot;end-to-end tests&quot; during development. You can find them all listed <a href="https://github.com/lopcode/vips-ffm/tree/main/sample/src/main/kotlin/vipsffm/sample">here</a>.</p>
<p>To get set up to run samples (on macOS):</p>
<ul>
<li><code>brew install vips</code></li>
<li><code>sdk use java 22-open</code></li>
<li>Then either:
<ul>
<li>Run <code>./run_samples.sh</code> in your terminal</li>
<li>Use the included <code>Run samples</code> profile in IntelliJ</li>
</ul>
</li>
</ul>
<pre><code>[main] INFO vipsffm.SampleRunner - clearing sample run directory at path &quot;sample_run&quot;
[main] INFO vipsffm.SampleRunner - running sample &quot;RawGetVersionSample&quot;...
[main] INFO vipsffm.RawGetVersionSample - libvips version: &quot;8.15.3&quot;
[main] INFO vipsffm.SampleRunner - validation succeeded ‚úÖ
[main] INFO vipsffm.SampleRunner - running sample &quot;HelperGetVersionSample&quot;...
[main] INFO vipsffm.HelperGetVersionSample - libvips version: &quot;8.15.3&quot;
[main] INFO vipsffm.SampleRunner - validation succeeded ‚úÖ
[main] INFO vipsffm.SampleRunner - running sample &quot;VImageCreateThumbnailSample&quot;...
[main] INFO vipsffm.RawGetVersionSample - source image size: 2490 x 3084
[main] INFO vipsffm.RawGetVersionSample - thumbnail image size: 323 x 400
[main] INFO vipsffm.SampleRunner - validation succeeded ‚úÖ
[main] INFO vipsffm.SampleRunner - running sample &quot;VImageChainSample&quot;...
[main] INFO vipsffm.SampleRunner - validation succeeded ‚úÖ
[main] INFO vipsffm.SampleRunner - running sample &quot;VSourceTargetSample&quot;...
[main] INFO vipsffm.SampleRunner - validation succeeded ‚úÖ
[main] INFO vipsffm.SampleRunner - running sample &quot;VImageCopyWriteSample&quot;...
[main] INFO vipsffm.SampleRunner - validation succeeded ‚úÖ
[main] INFO vipsffm.SampleRunner - running sample &quot;VOptionHyphenSample&quot;...
[main] INFO vipsffm.SampleRunner - validation succeeded ‚úÖ
[main] INFO vipsffm.SampleRunner - running sample &quot;VImageCachingSample&quot;...
[main] INFO vipsffm.SampleRunner - validation succeeded ‚úÖ
[main] INFO vipsffm.SampleRunner - shutting down vips to check for memory leaks...
memory: high-water mark 128.35 MB
[main] INFO vipsffm.SampleRunner - all samples ran successfully üéâ
</code></pre>
<h2 id="project-goals-heading">Project goals</h2>
<p>Ideas and suggestions are welcome, but please make sure they fit in to these goals, or you have a good argument about
why a goal should change!</p>
<ul>
<li>Avoid manual work by automating as much as possible. This means upstream changes can be rapidly integrated.</li>
<li>Use the libvips operations API, as described in the <a href="https://www.libvips.org/API/current/binding.html">libvips documentation</a></li>
<li>Provide access to the raw bindings (<code>VipsHelper</code>), so users aren't blocked by helper bugs or API annoyances.</li>
<li>Incubate in <a href="https://github.com/lopcode/photo-fox">Photo Fox</a> with some &quot;real world&quot; usage.</li>
</ul>
<h2 id="releasing-heading">Releasing</h2>
<ul>
<li>GitHub Releases automatically result in a deployment to GitHub Packages</li>
<li>Maven Central releases happen manually
<ul>
<li>This can only be done by @lopcode</li>
<li>And only after a GitHub Release is made</li>
<li>Run <code>./publish_release_to_maven_central.sh &lt;version matching github release version, including v prefix&gt;</code></li>
</ul>
</li>
</ul>
</div>
<div id="all-modules-table">
<div class="caption"><span>Modules</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Module</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color all-modules-table all-modules-table-tab1"><a href="app.photofox.vipsffm/module-summary.html">app.photofox.vipsffm</a></div>
<div class="col-last even-row-color all-modules-table all-modules-table-tab1">&nbsp;</div>
</div>
</div>
</main>
</div>
</body>
</html>
